{# Begin Branding for Print Page #}
<div class="row visible-print">
	<div class="col-xs-12 p">
		{% if app.params.logoimages is not empty %}
			{% set logo_info = app.params.logoimages | first %}
			{% set logo = logo_info.url %}
		{% endif %}
		{% if logo is not empty %}
		 	<img class="img-responsive" src="{{ logo }}" alt="">
		{% else %}
			<div id="logo-txt">{{ app.params.site.title }}</div>
		{% endif %}
	</div>
</div>
{# End Branding for Print Page #}
{% import "/_macros/form-elements-bootstrap.html.twig" as forms %}

{% if final_order is not empty %}
	<h1>Checkout Complete!</h1>
{% else %}
	<h1><i class="fa fa-exclamation-circle"></i><span>We Were Unable to Process Your Order </span></h1>
{% endif %}
{# Calculate subtotal without discounts #}
{% set subtotal = 0 %}

{% do app.user.setState('order_sent', null) %}

<div class="row">
	{# begin print page #} 
	<div class="{{ app.user.isLoggedIn() ? "col-xs-12" : "col-xs-12 col-md-8" }}">

		{% if final_order is not empty %}
		<div class="panel panel-default">
			<div class="panel-body">
				<h3>Thank You, your order has been placed!</h3>
				<p>We have sent you an e-mail confirmation.</p>
				{% if request.customer_id is defined %}
					<div>
						<a href="{{app.url}}/account/order/{{final_order.order_number}}">Order: #{{ final_order.order_number }}</a>
					</div>
					<div>Order Placed: {{ final_order.date_created|date("F jS, Y") }}</div>
				{% else %}
					<form name="order", action="{{app.url}}/order", method="POST", class="" id="view-order">
						<input type="hidden" name="order[id]" value="{{ final_order.order_number }}" />
						<input type="hidden" name="order[email]" value="{{ final_order.email}}" />
						<a href="javascript: $('form#view-order').submit();">Order: #{{ final_order.order_number }}</a>
					</form>
				{% endif %}
			</div>
		</div>
		{% set response = api.delete('/sessioncart') %}
		{% else %}
		<p>Unfortunately we were unable to complete your order. Please review your address and bank information to ensure it is correct. If it is correct, please contact us for assistance.</p>
		<p>Order placement failed with the following error(s):</p>
		{% if api.error is iterable %}
		<ul>
			{% for field, errors in api.error %}
			<li>
			{{field}}
				<ul>
					{% for error in errors %}
					<li>{{ error }}</li>
					{% endfor %}
				</ul>
			</li>
			{% endfor %}
		</ul>
		{% else %}
		<ul><li>{{ api.error }}</li></ul>
		{% endif %}
		<div class="mar-t">
			{% if request.token is defined %}
			<a class="btn btn-primary" href="{{app.url}}/checkout/paypal">Please Try Again</a>
			{% else %}
			<a class="btn btn-primary" href="{{app.url}}/checkout/billing">Please Try Again</a>
			{% endif %}
		</div>
		{% endif %}
		
		{% if final_order is not empty %}
		<div class="panel panel-default">
            <div class="panel-heading">Items Ordered</div>
            <div class="panel-body">
            {% for item in items %}
                <div class="row">
                    <div class="col-xs-8">
                        {{item.quantity}} x {{ item.name }}
                    </div>
                    {% set price = item.price * item.quantity %}
                    {% set subtotal = subtotal + price %}
                    <div class="col-xs-4 text-right">
                        ${{ item.price|number_format(2, '.') }}
                    </div>
                </div>
            {% endfor %}
            </div>
        </div>
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="fsd1 p">
					<div class="row">
						<div class="col-xs-12 col-sm-8 col-md-7 col-lg-8">
							<div class="row">
								<div class="col-xs-12 col-md-6">
									<div class="shipping-address p">
										<div><strong>Shipping Address:</strong></div>
										<div class="address">
											<div class="name">{{ final_order.shipping_first_name }} {{ final_order.shipping_last_name }}</div>
											<div class="address1">{{ final_order.shipping_street_line1 }}</div>
											<div class="city-state">{{ final_order.shipping_city }}, {{ final_order.shipping_state }} {{ final_order.shipping_zip }}</div>
										</div>
									</div>
								</div>
								<div class="col-xs-12 col-md-6">
									{% if final_order.billing_first_name %}
										<div class="billing-address p">
											<div><strong>Billing Address:</strong></div>
											<div class="address">
												<div class="name">{{ final_order.billing_first_name }} {{ final_order.billing_last_name }}</div>
												<div class="address1">{{ final_order.billing_street_line1 }}</div>
												<div class="city-state">{{ final_order.billing_city }}, {{ final_order.billing_state }} {{ final_order.billing_zip }}</div>
												<div class="billing-method">Card: {{ final_order.card_type }} | Last Digits {{ final_order.card_last4 }} </div>
											</div>
										</div>
									{% endif %}
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-4 col-md-5 col-lg-4">
							<div class="order-totals">
								<div class="row">
									<div class="col-xs-8">Subtotal:</div>
									<div class="col-xs-4 text-right">${{ final_order.item_subtotal|number_format(2, '.') }}</div>
								</div>
								<div class="row">
									<div class="col-xs-8">Shipping:</div>
									<div class="col-xs-4 text-right">${{ final_order.shipping_rate|number_format(2, '.') }}</div>
								</div>
								{% if final_order.discount_price > 0 %}
								<div class="row">
									<div class="col-xs-8">Discount:</div>
									<div class="col-xs-4 price-discount text-right">
										-${{ final_order.discount_price|number_format(2, '.')}}
									</div>
								</div>
								{% endif %}
								<div class="row">
									<div class="col-xs-8">Total Before Tax:</div>
									<div class="col-xs-4 text-right">${{ (final_order.subtotal + final_order.shipping_rate)|number_format(2, '.') }}</div>
								</div>
								<div class="row">
									<div class="col-xs-8">Sales Tax:</div>
									<div class="col-xs-4 text-right">${{ final_order.tax|number_format(2, '.')}}</div>
								</div>
								<div class="row">
									<div class="col-xs-8">Total:</div>
									<div class="col-xs-4 text-right">${{ final_order.total|number_format(2, '.') }}</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		{% endif %}
	</div>

	{% if app.user.isLoggedIn() == false %}
	<div class="col-xs-12 col-md-4">
		<div class="account-create">
			<div class="well">
				<h3>Create a New Account</h3>
				<p>Create an account and you'll be able to place orders, create registries, create wish lists, check the status of your orders, write reviews, and more!</p>
				{{ forms.begin('create', app.url ~ '/account/create', 'post') }}
					<fieldset>
						{{ forms.hidden('create[first_name]',final_order.billing_first_name) }}
						{{ forms.hidden('create[last_name]',final_order.billing_last_name) }}
						{{ forms.hidden('create[phone_number]',final_order.billing_phone_number) }}
						{{ forms.hidden('create[email]',final_order.email) }}
						{{ forms.hidden('create[confirm_email]',final_order.email) }}
						<div class="form-group">
							<label for="create-pass" class="control-label">Password (4-14 Characters)</label>
							{{ forms.password('create[password]', "", {class:'form-control parsley-validated', id:'create-pass', placeholder:"Password", required:true}) }}
						</div>
						<div class="form-group">
							<label for="create-pass2">Confirm Password</label>
							{{ forms.password('create[confirm_password]', "", {class:'form-control parsley-validated', id:'create-pass2', placeholder:"Confirm Password", required:true}) }}
						</div>
						<div class="actions form-group">
							{{ forms.submit('create[action]', 'create', 'Create Account', {class:'btn btn-lg btn-block btn-primary'})}}
						</div>
					</fieldset>
				{{ forms.end() }}
			</div>
		</div>
	</div>
	{% endif %}
</div>
{% if final_order is not empty %}
<div class="row">
	<div class="col-xs-12 col-sm-6 p">
		<a class="btn btn-xs-block btn-default" href="{{app.url}}">Continue Shopping</a>
	</div>

	<div class="col-xs-12 col-sm-6 p">
		<a href="#" class="btn btn-xs-block btn-default pull-right" onclick="window.print();return false;">Print Page</a>
	</div>
</div>
{% endif %}