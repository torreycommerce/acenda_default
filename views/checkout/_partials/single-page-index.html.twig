    {% if cart.items is empty or permissions.browse_catalog == false or permissions.show_prices == false or permissions.place_order == false %} {# Set cart products for acenda object #}
	{% do app.redirect('/cart') %}
{% endif %}

{% block content %}

<script type="application/javascript">
  var checkout_product_prices_include_tax = '{{ app.params.order.product_prices_include_tax }}';
  var saved_checkout_step = '{{ app.user.getState('current_step') }}';
</script>


<h1>Secure Checkout</h1>

<div class="checkoutapp">
	<div id="processing" style="display:none">
		<div class="jumbotron" id="processing-panel">
		        <p>Please wait while your order is being processed...</p>
		        <div class="progress">
		          <div id="checkout_process_percent" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
		            <span id="checkout_process_percent_text" class="sr-only">0% Complete</span>
		          </div>
		        </div>
		 </div>
	</div>		
	<div class="row">				
		<div id="checkout-left" class="col-lg-8">
			<div id="checkout-steps">
			    <div class="card">
			        <div id="signin-panel" class="card-header">
			        	<button id="btn-edit-signin" class="btn btn-default btn-xs float-right btn-edit" data-parent="#checkout-steps">Edit</button>
			            <h2>1. Sign In</h2>
			            <div class="step-data"></div>
			        </div>
			        <div id="collapseSignIn" class=" collapse">
			            <div class="card-body">
                             {% include "/checkout/_partials/single-page-steps/signin.html.twig" %}
			            </div>
			        </div>
			    </div>
			    <div id="shipping-panel" class="card">
			        <div class="card-header">
			        	<button id="btn-edit-shipping" class="btn btn-default btn-xs float-right btn-edit" data-parent="#checkout-steps" >Edit</button>
			            <h2>2. Shipping Address</h2>
			            <div class="step-data"></div>					            
			        </div>
			        <div id="collapseShipping" class=" collapse">
			            <div class="card-body">
							{% include "/checkout/_partials/single-page-steps/shipping.html.twig" %}
			            </div>
			        </div>
			    </div>
			    <div id="shipping-method-panel" class="card">
			        <div class="card-header">
			        	<button id="btn-edit-shipping-method" class="btn btn-default btn-xs float-right btn-edit" data-parent="#checkout-steps">Edit</button>
			            <h2>3. Shipping Method</h2>
			            <div class="step-data"></div>					            
			        </div>
			        <div id="collapseShippingMethod" class=" collapse">
			            <div class="card-body">
							{% include "/checkout/_partials/single-page-steps/shipping-method.html.twig" %}
			            </div>
			        </div>
			    </div>					    
			    <div id="payment-panel" class="card">
			        <div class="card-header">
			        	<button id="btn-edit-payment" class="btn btn-default btn-xs float-right btn-edit" data-parent="#checkout-steps">Edit</button>
			            <h2>4. Payment</h2>
			            <div class="step-data"></div>					            
			        </div>
			        <div id="collapsePayment" class=" collapse">
			            <div class="card-body">
							{% include "/checkout/_partials/single-page-steps/payment.html.twig" %}
			            </div>
			        </div>
			    </div>					    
			    <div id="review-panel" class="card">
			        <div class="card-header">
			            <h2>5. Review Your Order</h2>
			        </div>
			        <div id="collapseReview" class=" collapse">
			            <div class="card-body">
							{% include "/checkout/_partials/single-page-steps/review.html.twig" %}
			            </div>
			        </div>
			    </div>
			</div>
		</div>
		<div id="checkout-right" class="col-lg-4">
			<div id="summary-panel" style="min-height: 200px">
				<div class="card" >
					<div class="card-header"><h2>Order Summary</h2></div>
					<div class="card-body" >
						<h3>Items (<span id="num-items"></span>)</h3>
							<div id="item-list">
							</div>
							<div class="d-none" id="item-list-copy">
								<div class="divide g item mb-3 pb-3">
									{% spaceless %}
									<div class="media">
										<div class="media-left">
											<img class="media-object" src="{{ app.url_asset }}/assets/images/product/image-250x250.gif{#<%= variant.get('thumbnail') %>#}" width="250" height="250" alt="">
										</div>
										<div class="media-body">
											<div class="name product-name">
											</div>
											<div class="availability">
											</div>
											<div class="qty">Qty: </div>
											<div class="pricing"><div class="price">
												{{ prod.currency("0.00") }}<span class="lang"> each</span>
											</div></div>
										</div>
									</div>
									{% endspaceless %}
								</div>
							</div>
							<div class="d-none" id="item-list-data">
							</div>
						<hr/>
						<div id="totals-section">
						</div>
						<div class="d-none" id="totals-section-copy">
						    <div class="divide mb-3 pb-3">
								<div class="row totals-subtotal">
									<div class="amount col-7">Subtotal:</div>
									<div class="amount col-5 text-right">
										{{ prod.currency("0.00") }}
									</div>
								</div>
								<div class="row totals-shipping">
									<div class="amount col-7">Shipping:</div>
									<div class="amount col-5 text-right">
										{{ prod.currency("0.00") }}
									</div>
								</div>
								<div class="row totals-discount">
									<div class="amount col-7">Discount:</div>
									<div class="amount col-5 text-right price-discount">
										{{ prod.currency("0.00") }}
									</div>
								</div>
								<div class="row totals-tax">
									<div class="amount col-7">Tax:</div>
									<div class="amount col-5 text-right">
										{{ prod.currency("0.00") }}
									</div>
								</div>
							</div>
							<div class="row totals-total">
								<div class="amount col-7">Total:</div>
								<div class="amount col-5 text-right">
									{{ prod.currency("0.00") }}
								</div>
							</div>
						</div>
						<div class="d-none" id="totals-section-data"></div>
					</div>
				</div>

				<div class="card">
					<div class="card-body">
                        <h3>Coupon Code</h3>
						<form name="coupon">
							<div class="form-group">
								<label for="cart_coupon_code">Enter Coupon Code:</label>
								<div class="row">
									<div class="col-6 col-md-9 col-lg-7 col-xl-8">
										{{ forms.text('cart[coupon_code]', coupon_code, {class:'form-control parsley-validated', id:'cart_coupon_code', placeholder: "Coupon Code"}) }}
									</div>
									<div class="col-6 col-md-3 col-lg-5 col-xl-4">
										<button id="checkout_enter_coupon" class="btn btn-primary btn-block">Apply</button>

									</div>
								</div>
								<div id="enter_coupon_validation"></div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>					
	</div>
</div> 

<script id="summary-item-compress" type="text/template">
	<div class="compressed-item">
		<p class="t"><%= variant.get('thumbnail') %></p>
		<p class="n"><%= variant.get('name') %></p>
		<p class="s"><%= variant.get('has_stock')?"In Stock":"Out of Stock" %></p>
		<p class="q">Qty: <%= item.quantity %></p>
		<p class="p"><%= variant.get('price') %></p>
		<p class="l">
		<% if(item.wishlist_id) { %>
			<div mb-3 class="wishlist mb-3"><a href="{{ app.url }}"><i class="icon icon-list"></i> For </a></div>
		<% } %>
		<% if(item.registry_id) { %>
			<div mb-3 class="registry mb-3"><a href="{{ app.url }}"><i class="icon icon-list"></i> For </a></div>
		<% } %>
		</p>
	</div>
</script>

<script id="summary-totals-compress" type="text/template">
	<div class="discounts">
	<% for(var d in cart.discount_collection.discounts) {{ '{' }} var discount = cart.discount_collection.discounts[d];  %>
     	
		<% if(discount.type == 'coupon'){{ '{' }}  %>
		<div class="discount">
			<div class="alert alert-info">
				<button class="float-right btn btn-info btn-xs remove-coupon" id="remove-coupon-<%= discount.id %>">Remove</button>
				<p>
				<b>Coupon: <%= discount.code %></b>
				<% if(discount.description) {{ '{' }} %><br><% {{ '}' }} %>
				<%= discount.description %>
				</p>

			</div>
		</div>
		<% {{ '}' }}  %>
	<% {{ '}' }}  %>
	</div>
	<p class="c-ist"><%= parseFloat(cart.item_subtotal).toFixed(2) %></p>
	<% if(cart.shipping_method ) { %>
	<p class="c-sr"><%= parseFloat(cart.shipping_rate).toFixed(2) %></p>
	<% } %>
	<% if(parseFloat(cart.discount_price) > 0) { %>
	<p class="c-dp"><%= parseFloat(cart.discount_price).toFixed(2) %></p>
	<% } %>
	<% if(cart.tax_rate) { %>
	<p class="c-tr"><%= parseFloat(cart.tax_rate).toFixed(2) %></p>
	<% } %>
	<p class="c-t"><%= parseFloat(cart.total).toFixed(2) %></p>
</script>

<script id="shipping-methods-template" type="text/template">
    <div class="table-responsive">
	<table  class="table">
	<thead>
        <tr>
		    <th>Method</th>
			<th>Est<span class="d-none d-md-block">imated</span> Arrival</th>
			<th class="text-right">Price</th>
		</tr>
	</thead>
	<tbody>
		<% _.each(methods,function(method) { %>
			<% if(method.status=='active') { %>
			    <tr>
			        <td><div class="custom-control custom-radio"><input <%= (method.id == current_method)?'checked':''  %> type="radio" class="custom-control-input" id="method_<%= method.id %>_input" name="shipping_method" value="<%= method.id %>"><label class="custom-control-label" for="method_<%= method.id %>_input"><%= method.name %></label></div></td>
			        <td><label for="method_<%= method.id %>_input"><%= method.bottom_days_range %> - <%= method.top_days_range %> days</label></td>
			        <td class="text-right"><label for="method_<%= method.id %>_input">{{ prod.currency("0.00") }}<span class="d-none"><% if(typeof method.price==='undefined') {{ '{' }}  %><span class="price"><i class="fa fa-refresh fa-spin spinner" style="font-size:24px"></i><% {{ '}' }} %><%= method.price %></span></span></label></td>
			    </tr>
			    <% } %>
	    <% }) %>
	</tbody>
	</table>
	</div>
</script>
{% endblock %}


{% block js %}
    {{ app.asset.js(app.url_asset ~ '/assets/js/sticky-kit.min.js') }}	
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/models/customer.js') }}	        
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/models/order.js') }}	
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/models/product.js') }}
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/models/variant.js') }}           	
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/models/cart.js') }}
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/collections/customeraddresses.js') }} 
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/collections/shippingmethods.js') }}       
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/collections/shippingcountries.js') }}
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/collections/billingcountries.js') }}    
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/collections/shippingstates.js') }}
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/collections/billingstates.js') }}       
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/views/summary-view.js') }}    
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/views/checkout-view.js') }}
    {{ app.asset.js(app.url_asset ~ '/assets/js/checkoutbb/checkoutbb.js') }}
{% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css" href="{{app.url_asset}}/assets/css/theme/checkout.css" />
{% endblock %}