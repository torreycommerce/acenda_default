{%- import "/_macros/base.html.twig" as base -%}
{%- import "/_macros/product.html.twig" as prod -%}
{% spaceless %}

{# Getting Seo from config.mode.json #}
{% if app.params.seo is defined and app.params.seo is not empty %}
	{% set seo = app.params.seo %}
{% else %}
	{% set seo = { img: "", description: "", keywords: "", title: "Home" } %}
{% endif %}
{# End Config Seo #}
{# Scripts #}


{{ app.asset.js(app.url_asset ~ '/assets/js/jquery-2.1.4.min.js') }}
{{ app.asset.js(app.url_asset ~ '/assets/js/underscore-min.js') }}
{{ app.asset.js(app.url_asset ~ '/assets/js/backbone-min.js') }}

{{ app.asset.js(app.url_asset ~ '/assets/js/bootstrap/bootstrap.js') }}
{{ app.asset.js(app.url_asset ~ '/assets/js/parsley.min.js') }}
{{ app.asset.js(app.url_asset ~ '/assets/js/parsley.extend.min.js') }}
{{ app.asset.js(app.url_asset ~ '/assets/js/jquery.cascadingdropdown.js') }}
{{ app.asset.js(app.url_asset ~ '/assets/js/normalizer.js') }}
{{ app.asset.js(app.url_asset ~ '/assets/js/site.js') }}


{% if app.params.seo.google_analytics is not empty or app.params.seo.google_tag_manager is not empty %}
{{ app.asset.js(app.url_asset ~ '/assets/js/acendaAnalytics.js') }}
{% endif %}
{# End Scripts #}
{% endspaceless %}

{% set url_based_class = app.request.url|split('/')|last %}
{% set url_based_array = app.request.url|split('/') %}
{% set url_based_class = '' %}
{% for part in url_based_array %}
	{% set url_based_class = url_based_class ~ ' url-' ~ loop.index ~ '-' ~ part | e %}
{% endfor %}
{% if url_based_array.0 | trim == ''%}
	{% set url_based_class = 'store-home-page' %}
{% endif %}

<!DOCTYPE html>
<html class="{% spaceless %}{{ url_based_class }}{% endspaceless %} {% spaceless %}{% block dynamicclasses %}{% endblock %}{% endspaceless %}">
<head>
{% if app.params.seo.google_tag_manager is not empty and app.params.seo.google_analytics is empty %}
	<!-- Google Tag Manager DataLayer -->
	<script>
		var dataLayer = [];
		{% block dataLayer %}
			{% include '/_partials/analytics/tag-manager.html.twig' %} {# Google Tag Manager Snippet #}
		{% endblock %}
	</script>
	<!-- Google Tag Manager DataLayer End -->
{% endif %}
{% block head %}
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="keywords" content="{% block meta_keywords %}{{ seo['keywords'] }}{% endblock %}">
<meta name="description" content="{% block meta_description %}{{ seo['description'] }}{% endblock %}">
<link rel="shortcut icon" href="{{ app.url ~ '/favicon.ico' ~ '?time=' ~ app.params.site.title }}" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="{{app.url_asset}}/assets/css/theme/acendastrap.css" />
<link rel="stylesheet" type="text/css" href="{{app.url_asset}}/assets/css/theme/theme.css" />
<link rel="stylesheet" type="text/css" href="{{app.url_asset}}/assets/css/custom.css" />


<link rel="sitemap" href="{{app.url}}/api/sitemap" />
<link rel="canonical" href="{{ app.request.base ~ '/' ~ app.request.url | replace({'\"':'',"\'":''})  }}"/>

{% block css %}
{% endblock %}

<title>{% block title %}{% if app.params.site.page_title %}{{ app.params.site.page_title }}{% else %}{{ app.params.site.title}}{% endif %}{% endblock %}</title>

{% if app.params.social_settings is defined and app.params.social_settings is not empty %}
	{{ social.get_metatags(app.params.social_settings, seo) }}
{% endif %}

<script>
var acendaBaseName = '{{app.params.site.title}}'
var acendaBaseUrl = '{{app.url}}'
var acendaBaseThemeUrl = '{{app.url_asset}}'
</script>
<script>
	{% block acenda %}
		{% include '/_partials/analytics/acenda.html.twig' %}
	{% endblock %}
</script>


	{% endblock %}
</head>
<body>
{% if app.params.seo.google_tag_manager is not empty and app.params.seo.google_analytics is empty %}
	<!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ app.params.seo.google_tag_manager }}"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->
{% endif %}		
	{% include "/_layouts/stage_header.html.twig" %}

	<div id="body">

		{% block body %}
			<!--[if lte IE 8]>
			<div id="outdated-warning" class="alert alert-dismissable alert-block alert-danger flash-note flash-note-danger">
			<h4>Please upgrade your browser!</h4><br>
			<p>Please upgrade to <a href="http://getfirefox.com" class="alert-link">Firefox</a>, <a href="http://www.google.com/chrome" class="alert-link">Chrome</a> or <a href="http://www.microsoft.com/windows/downloads/ie/getitnow.mspx" class="alert-link">Internet Explorer 9 or 10</a>. Thank you!</p>
			</div>
			<![endif]-->
		{# Begin Header #}
			<header id="header">
				{{ base.protected_site() }}
				{# avoiding the display of the menu when we're in the store-protected template #}
				{% if app.request.url != "store-protected" %}
					{# Begin Toolbar #}
					{% block header %}
						{%include "/_layouts/toolbar.html.twig"%}
					{% endblock %}
					{# End Toolbar #}
				{% endif %}
				{# avoiding the display of the menu when we're in the store-protected template #}
				{% if app.request.url != "store-protected" %}
					{# Begin Navigation #}
						{% include "/_layouts/nav.html.twig" %}
					{# End Navigation #}
				{% endif %}
			</header>
			{# End Header #}
			{# Begin Content #}
			<section class="pad-h pad-b-2x" id="content">
				<div class="container">
					{% block breadcrumb %}{% endblock %}
					{% block stage %}
						{% block content %}
						{% endblock %}
					{% endblock %}
				</div>
			</section>
			{# End Content #}
			{# Begin Footer #}
				{% block footer %}
				{%include "/_layouts/footer.html.twig"%}
				{% endblock %}
			{# End Footer #}
		{% endblock %}
		{% block js %}{% endblock %}
	</div>

{% if '/preview/' in app.url and 'store-protected' not in app.request.url and app.request.get["theme_id"] is null %}
	{% set request = app.url | split('/preview/') %}
	{% set back_to = request.0 %}
	<nav id="admin-bar" class="navbar navbar-fixed-top hidden-xs" role="navigation">
		<div class="container-fluid">
			<div class="btn-group">
				<button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
					<img src="{{ app.params.url.preview ~ '/../../images/acenda-logo-tm-white.png'}}"><i class="fa fa-caret-down"></i>
				</button>
				<ul class="dropdown-menu fsd1 fa-fa-balance" role="menu">
					{% set  sandboxMode = api.get('site/ispaypalsandbox') %}
					{% if sandboxMode is not empty %}
					<li>
						<a href="#" ref='{{ back_to }}/site-settings#paymentplatforms' target="_blank"><i class="fa fa-exclamation-triangle"></i> <span>PayPal <span class="hidden">PayflowPro</span> is in Test Mode (Sandbox)</span></a>
					</li>
					<li role="separator" class="divider"></li>
					{% endif %}
					<li>
						<a href="#" onClick="window.location.href='{{ back_to }}'; return false;" ><i class="fa fa-cog"></i> <span>Visit Your Admin</span></a>
					</li>
					<li>
					{% if '/preview/' in app.url  %}
						<a href="#" onClick="window.location.href='{{ app.params.url.live }}'; return false;" ><i class="fa fa-rocket"></i> <span>Visit Your Live Site</span></a>
					{% endif %}
					</li>
				</ul>
			</div>
		</div>
	</nav>

{% endif %}
</body>
</html>