<section class="product-grid">

    <h2>What's Hot</h2>

    <div class="products row text-center">
        {% set collection_ids = [] %}
        {% set product_count = 1 %}
        {% set products = api.get('/catalog',{query:"group:product,custom_field_name:1"}, {sort:"product.popularity:-1",limit:12}) %}
        {% for row,product in products if  product.id not in collection_ids and product_count < 13 %}
            {% if product.group == 'product' %}
                {% for id in product.product[0].collection_id %}
                    {% set collection_ids = collection_ids|merge([id]) %}
                {% endfor %}
            {% else %}
                {% set collection_ids = collection_ids|merge([product.id]) %}
            {% endif %}
            {% set product_count = product_count + 1 %}
            {# Begin product #}
            <div class="col-6 col-md-3 mb-4">
                {{ prod.gridproduct(product, ['image','details']) }}
            </div>
            {# End product #}
        {% endfor %}
    </div>
</section>